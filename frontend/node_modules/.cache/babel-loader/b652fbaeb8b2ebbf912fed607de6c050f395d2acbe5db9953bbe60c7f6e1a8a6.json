{"ast":null,"code":"/**\r\n * Utility functions for handling authentication tokens\r\n */\n\n// Глобальный объект для хранения информации о токене\nconst tokenInfo = {\n  tokenTimer: null,\n  tokenExpiryWarningShown: false\n};\n\n/**\r\n * Get the current user from localStorage\r\n * @returns {Object|null} The user object or null if not found\r\n */\nexport const getCurrentUser = () => {\n  const userStr = localStorage.getItem('user');\n  if (userStr) {\n    try {\n      return JSON.parse(userStr);\n    } catch (error) {\n      console.error('Error parsing user from localStorage:', error);\n      return null;\n    }\n  }\n  return null;\n};\n\n/**\r\n * Get the authentication token from localStorage\r\n * @returns {string|null} The token or null if not found\r\n */\nexport const getToken = () => {\n  const user = getCurrentUser();\n  return (user === null || user === void 0 ? void 0 : user.accessToken) || null;\n};\n\n/**\r\n * Save user data (including token) to localStorage\r\n * @param {Object} userData The user data to save\r\n */\nexport const saveUser = userData => {\n  if (userData) {\n    localStorage.setItem('user', JSON.stringify(userData));\n\n    // Устанавливаем таймер для проверки срока действия токена\n    // и предупреждения пользователя перед истечением\n    setupTokenExpiryTimer();\n  }\n};\n\n/**\r\n * Remove user data and token from localStorage\r\n */\nexport const removeUser = () => {\n  localStorage.removeItem('user');\n  clearTokenTimers();\n};\n\n/**\r\n * Update token in axios headers\r\n * @param {Object} api The axios instance\r\n * @param {string} token The token to set\r\n */\nexport const setAuthHeader = (api, token) => {\n  if (token) {\n    api.defaults.headers.common['x-access-token'] = token;\n  } else {\n    delete api.defaults.headers.common['x-access-token'];\n  }\n};\n\n/**\r\n * Настройка таймера для проверки срока истечения токена\r\n */\nexport const setupTokenExpiryTimer = () => {\n  // Очищаем предыдущий таймер, если он был\n  clearTokenTimers();\n\n  // Время предупреждения - за 5 минут до истечения\n  const warningBeforeExpiry = 5 * 60 * 1000; // 5 минут\n\n  // Время полного срока действия токена (2 часа)\n  const tokenLifetime = 2 * 60 * 60 * 1000; // 2 часа в миллисекундах\n\n  // Устанавливаем таймер для предупреждения\n  tokenInfo.tokenTimer = setTimeout(() => {\n    // Предупреждаем пользователя об истечении срока токена\n    if (!tokenInfo.tokenExpiryWarningShown) {\n      console.log('Token will expire soon, user should re-login');\n      // Показываем системное уведомление, если возможно\n      if ('Notification' in window && Notification.permission === 'granted') {\n        new Notification('Предупреждение о сессии', {\n          body: 'Ваша сессия скоро истечет. Пожалуйста, сохраните данные и войдите заново.'\n        });\n      }\n\n      // Отмечаем, что предупреждение показано\n      tokenInfo.tokenExpiryWarningShown = true;\n    }\n  }, tokenLifetime - warningBeforeExpiry);\n};\n\n/**\r\n * Очистка всех таймеров, связанных с токеном\r\n */\nexport const clearTokenTimers = () => {\n  if (tokenInfo.tokenTimer) {\n    clearTimeout(tokenInfo.tokenTimer);\n    tokenInfo.tokenTimer = null;\n  }\n  tokenInfo.tokenExpiryWarningShown = false;\n};\n\n/**\r\n * Обновляет объект пользователя с новыми данными, сохраняя существующий токен\r\n * @param {Object} userUpdate - Новые данные пользователя\r\n */\nexport const updateUserData = userUpdate => {\n  const currentUser = getCurrentUser();\n  if (currentUser && userUpdate) {\n    // Сохраняем текущий токен\n    const updatedUser = {\n      ...currentUser,\n      ...userUpdate\n    };\n    localStorage.setItem('user', JSON.stringify(updatedUser));\n  }\n};","map":{"version":3,"names":["tokenInfo","tokenTimer","tokenExpiryWarningShown","getCurrentUser","userStr","localStorage","getItem","JSON","parse","error","console","getToken","user","accessToken","saveUser","userData","setItem","stringify","setupTokenExpiryTimer","removeUser","removeItem","clearTokenTimers","setAuthHeader","api","token","defaults","headers","common","warningBeforeExpiry","tokenLifetime","setTimeout","log","window","Notification","permission","body","clearTimeout","updateUserData","userUpdate","currentUser","updatedUser"],"sources":["C:/Users/Masha/Desktop/KP/frontend/src/utils/tokenUtils.js"],"sourcesContent":["/**\r\n * Utility functions for handling authentication tokens\r\n */\r\n\r\n// Глобальный объект для хранения информации о токене\r\nconst tokenInfo = {\r\n  tokenTimer: null,\r\n  tokenExpiryWarningShown: false,\r\n};\r\n\r\n/**\r\n * Get the current user from localStorage\r\n * @returns {Object|null} The user object or null if not found\r\n */\r\nexport const getCurrentUser = () => {\r\n  const userStr = localStorage.getItem('user');\r\n  if (userStr) {\r\n    try {\r\n      return JSON.parse(userStr);\r\n    } catch (error) {\r\n      console.error('Error parsing user from localStorage:', error);\r\n      return null;\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\n/**\r\n * Get the authentication token from localStorage\r\n * @returns {string|null} The token or null if not found\r\n */\r\nexport const getToken = () => {\r\n  const user = getCurrentUser();\r\n  return user?.accessToken || null;\r\n};\r\n\r\n/**\r\n * Save user data (including token) to localStorage\r\n * @param {Object} userData The user data to save\r\n */\r\nexport const saveUser = (userData) => {\r\n  if (userData) {\r\n    localStorage.setItem('user', JSON.stringify(userData));\r\n    \r\n    // Устанавливаем таймер для проверки срока действия токена\r\n    // и предупреждения пользователя перед истечением\r\n    setupTokenExpiryTimer();\r\n  }\r\n};\r\n\r\n/**\r\n * Remove user data and token from localStorage\r\n */\r\nexport const removeUser = () => {\r\n  localStorage.removeItem('user');\r\n  clearTokenTimers();\r\n};\r\n\r\n/**\r\n * Update token in axios headers\r\n * @param {Object} api The axios instance\r\n * @param {string} token The token to set\r\n */\r\nexport const setAuthHeader = (api, token) => {\r\n  if (token) {\r\n    api.defaults.headers.common['x-access-token'] = token;\r\n  } else {\r\n    delete api.defaults.headers.common['x-access-token'];\r\n  }\r\n};\r\n\r\n/**\r\n * Настройка таймера для проверки срока истечения токена\r\n */\r\nexport const setupTokenExpiryTimer = () => {\r\n  // Очищаем предыдущий таймер, если он был\r\n  clearTokenTimers();\r\n  \r\n  // Время предупреждения - за 5 минут до истечения\r\n  const warningBeforeExpiry = 5 * 60 * 1000; // 5 минут\r\n  \r\n  // Время полного срока действия токена (2 часа)\r\n  const tokenLifetime = 2 * 60 * 60 * 1000; // 2 часа в миллисекундах\r\n  \r\n  // Устанавливаем таймер для предупреждения\r\n  tokenInfo.tokenTimer = setTimeout(() => {\r\n    // Предупреждаем пользователя об истечении срока токена\r\n    if (!tokenInfo.tokenExpiryWarningShown) {\r\n      console.log('Token will expire soon, user should re-login');\r\n      // Показываем системное уведомление, если возможно\r\n      if ('Notification' in window && Notification.permission === 'granted') {\r\n        new Notification('Предупреждение о сессии', {\r\n          body: 'Ваша сессия скоро истечет. Пожалуйста, сохраните данные и войдите заново.',\r\n        });\r\n      }\r\n      \r\n      // Отмечаем, что предупреждение показано\r\n      tokenInfo.tokenExpiryWarningShown = true;\r\n    }\r\n  }, tokenLifetime - warningBeforeExpiry);\r\n};\r\n\r\n/**\r\n * Очистка всех таймеров, связанных с токеном\r\n */\r\nexport const clearTokenTimers = () => {\r\n  if (tokenInfo.tokenTimer) {\r\n    clearTimeout(tokenInfo.tokenTimer);\r\n    tokenInfo.tokenTimer = null;\r\n  }\r\n  tokenInfo.tokenExpiryWarningShown = false;\r\n};\r\n\r\n/**\r\n * Обновляет объект пользователя с новыми данными, сохраняя существующий токен\r\n * @param {Object} userUpdate - Новые данные пользователя\r\n */\r\nexport const updateUserData = (userUpdate) => {\r\n  const currentUser = getCurrentUser();\r\n  if (currentUser && userUpdate) {\r\n    // Сохраняем текущий токен\r\n    const updatedUser = {\r\n      ...currentUser,\r\n      ...userUpdate,\r\n    };\r\n    localStorage.setItem('user', JSON.stringify(updatedUser));\r\n  }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}