{"ast":null,"code":"import api from './api';\nclass UserService {\n  // Get all users (for admin purposes only)\n  async getAllUsers() {\n    const response = await api.get('/admin/users');\n    return response.data;\n  }\n\n  // Search users by query\n  async searchUsers(query, retryCount = 0) {\n    try {\n      // Проверяем, не пустой ли запрос\n      if (!query || !query.trim()) {\n        return []; // Возвращаем пустой массив вместо ошибки\n      }\n\n      // Проверяем минимальную длину запроса\n      if (query.trim().length < 2) {\n        console.log('Search query too short, minimum 2 characters required');\n        return []; // Возвращаем пустой массив для коротких запросов\n      }\n\n      // Подготавливаем запрос\n      const searchQuery = query.trim();\n      console.log('Preparing search with query:', searchQuery);\n      try {\n        // Отправляем POST запрос вместо GET\n        const response = await api.post(`/admin/users/search`, {\n          query: searchQuery\n        }, {\n          timeout: 30000\n        } // Увеличиваем таймаут для поисковых запросов\n        );\n\n        // Проверяем тип ответа - должен быть массив\n        if (Array.isArray(response.data)) {\n          console.log('Received valid array response, length:', response.data.length);\n          return response.data;\n        } else if (response.data && response.data.results && Array.isArray(response.data.results)) {\n          console.log('Received results in data object, length:', response.data.results.length);\n          return response.data.results;\n        } else {\n          console.log('Received non-array response:', response.data);\n          // Если получили не массив, возвращаем пустой массив вместо ошибки\n          return [];\n        }\n      } catch (requestError) {\n        console.error('Error in searchUsers service:', requestError);\n\n        // Выводим больше деталей об ошибке\n        if (requestError.response) {\n          console.log('Response status:', requestError.response.status);\n          console.log('Response data:', requestError.response.data);\n        }\n\n        // Если это ошибка сервера (500) и у нас есть еще попытки, пробуем снова\n        if (requestError.response && requestError.response.status === 500 && retryCount < 3) {\n          console.log(`Retry attempt ${retryCount + 1} for search query`);\n\n          // Увеличиваем задержку перед повторными попытками\n          await new Promise(resolve => setTimeout(resolve, 2000 * (retryCount + 1)));\n\n          // Рекурсивно вызываем себя с увеличенным счетчиком повторов\n          return this.searchUsers(query, retryCount + 1);\n        }\n\n        // Если все попытки исчерпаны или это не ошибка 500, возвращаем пустой массив\n        return [];\n      }\n    } catch (error) {\n      console.error('Global error in searchUsers service:', error);\n      return []; // Возвращаем пустой массив при любой ошибке\n    }\n  }\n\n  // Get user details by ID\n  async getUserById(id) {\n    const response = await api.get(`/admin/users/${id}`);\n    return response.data;\n  }\n\n  // Update user roles\n  async updateUserRoles(userId, roles) {\n    const response = await api.put(`/admin/users/${userId}/roles`, {\n      roles\n    });\n    return response.data;\n  }\n\n  // Update user status (active/inactive)\n  async updateUserStatus(userId, isActive) {\n    const response = await api.put(`/admin/users/${userId}/status`, {\n      isActive\n    });\n    return response.data;\n  }\n\n  // Upload profile image\n  async uploadProfileImage(imageFile) {\n    const formData = new FormData();\n    formData.append('profileImage', imageFile);\n    const response = await api.post('/user/profile/image', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    return response.data;\n  }\n\n  // Get all workers (for task assignment)\n  async getAllWorkers() {\n    const response = await api.get('/workers');\n    return response.data;\n  }\n\n  // Search workers by name, username, or position\n  async searchWorkers(query) {\n    try {\n      if (!query || query.trim().length < 2) {\n        return [];\n      }\n      const response = await api.get(`/workers/search?query=${encodeURIComponent(query.trim())}`);\n      return Array.isArray(response.data) ? response.data : [];\n    } catch (error) {\n      console.error('Error searching workers:', error);\n      return [];\n    }\n  }\n\n  // Get all managers\n  async getAllManagers() {\n    const response = await api.get('/admin/managers');\n    return response.data;\n  }\n}\nexport default new UserService();","map":{"version":3,"names":["api","UserService","getAllUsers","response","get","data","searchUsers","query","retryCount","trim","length","console","log","searchQuery","post","timeout","Array","isArray","results","requestError","error","status","Promise","resolve","setTimeout","getUserById","id","updateUserRoles","userId","roles","put","updateUserStatus","isActive","uploadProfileImage","imageFile","formData","FormData","append","headers","getAllWorkers","searchWorkers","encodeURIComponent","getAllManagers"],"sources":["C:/Users/Masha/Desktop/KP/frontend/src/services/user.service.js"],"sourcesContent":["import api from './api';\r\n\r\nclass UserService {\r\n  // Get all users (for admin purposes only)\r\n  async getAllUsers() {\r\n    const response = await api.get('/admin/users');\r\n    return response.data;\r\n  }\r\n\r\n  // Search users by query\r\n  async searchUsers(query, retryCount = 0) {\r\n    try {\r\n      // Проверяем, не пустой ли запрос\r\n      if (!query || !query.trim()) {\r\n        return []; // Возвращаем пустой массив вместо ошибки\r\n      }\r\n      \r\n      // Проверяем минимальную длину запроса\r\n      if (query.trim().length < 2) {\r\n        console.log('Search query too short, minimum 2 characters required');\r\n        return []; // Возвращаем пустой массив для коротких запросов\r\n      }\r\n      \r\n      // Подготавливаем запрос\r\n      const searchQuery = query.trim();\r\n      console.log('Preparing search with query:', searchQuery);\r\n      \r\n      try {\r\n        // Отправляем POST запрос вместо GET\r\n        const response = await api.post(`/admin/users/search`, \r\n          { query: searchQuery },\r\n          { timeout: 30000 } // Увеличиваем таймаут для поисковых запросов\r\n        );\r\n        \r\n        // Проверяем тип ответа - должен быть массив\r\n        if (Array.isArray(response.data)) {\r\n          console.log('Received valid array response, length:', response.data.length);\r\n          return response.data;\r\n        } else if (response.data && response.data.results && Array.isArray(response.data.results)) {\r\n          console.log('Received results in data object, length:', response.data.results.length);\r\n          return response.data.results;\r\n        } else {\r\n          console.log('Received non-array response:', response.data);\r\n          // Если получили не массив, возвращаем пустой массив вместо ошибки\r\n          return [];\r\n        }\r\n      } catch (requestError) {\r\n        console.error('Error in searchUsers service:', requestError);\r\n        \r\n        // Выводим больше деталей об ошибке\r\n        if (requestError.response) {\r\n          console.log('Response status:', requestError.response.status);\r\n          console.log('Response data:', requestError.response.data);\r\n        }\r\n        \r\n        // Если это ошибка сервера (500) и у нас есть еще попытки, пробуем снова\r\n        if (requestError.response && requestError.response.status === 500 && retryCount < 3) {\r\n          console.log(`Retry attempt ${retryCount + 1} for search query`);\r\n          \r\n          // Увеличиваем задержку перед повторными попытками\r\n          await new Promise(resolve => setTimeout(resolve, 2000 * (retryCount + 1)));\r\n          \r\n          // Рекурсивно вызываем себя с увеличенным счетчиком повторов\r\n          return this.searchUsers(query, retryCount + 1);\r\n        }\r\n        \r\n        // Если все попытки исчерпаны или это не ошибка 500, возвращаем пустой массив\r\n        return [];\r\n      }\r\n    } catch (error) {\r\n      console.error('Global error in searchUsers service:', error);\r\n      return []; // Возвращаем пустой массив при любой ошибке\r\n    }\r\n  }\r\n\r\n  // Get user details by ID\r\n  async getUserById(id) {\r\n    const response = await api.get(`/admin/users/${id}`);\r\n    return response.data;\r\n  }\r\n\r\n  // Update user roles\r\n  async updateUserRoles(userId, roles) {\r\n    const response = await api.put(`/admin/users/${userId}/roles`, { roles });\r\n    return response.data;\r\n  }\r\n\r\n  // Update user status (active/inactive)\r\n  async updateUserStatus(userId, isActive) {\r\n    const response = await api.put(`/admin/users/${userId}/status`, { isActive });\r\n    return response.data;\r\n  }\r\n\r\n  // Upload profile image\r\n  async uploadProfileImage(imageFile) {\r\n    const formData = new FormData();\r\n    formData.append('profileImage', imageFile);\r\n    \r\n    const response = await api.post('/user/profile/image', formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    });\r\n    return response.data;\r\n  }\r\n\r\n  // Get all workers (for task assignment)\r\n  async getAllWorkers() {\r\n    const response = await api.get('/workers');\r\n    return response.data;\r\n  }\r\n\r\n  // Search workers by name, username, or position\r\n  async searchWorkers(query) {\r\n    try {\r\n      if (!query || query.trim().length < 2) {\r\n        return [];\r\n      }\r\n      \r\n      const response = await api.get(`/workers/search?query=${encodeURIComponent(query.trim())}`);\r\n      return Array.isArray(response.data) ? response.data : [];\r\n    } catch (error) {\r\n      console.error('Error searching workers:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Get all managers\r\n  async getAllManagers() {\r\n    const response = await api.get('/admin/managers');\r\n    return response.data;\r\n  }\r\n}\r\n\r\nexport default new UserService(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}